#! /bin/sh

PG_ARGS="--host=${POSTGRES_HOST} --port=${POSTGRES_PORT}"

pg_isready ${PG_ARGS} 2>&1 >/dev/null
if [ $? -ne 0 ]; then
  echo "Unable to connect to postgres at ${POSTGRES_HOST}:${POSTGRES_PORT}."
  exit 1
fi

/bin/init-icinga || exit 1
/bin/init-icingaweb || exit 1
/bin/init-director || exit 1

rm -f ~/.pgpass
